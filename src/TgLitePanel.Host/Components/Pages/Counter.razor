@page "/login"

<PageTitle>登录</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraSmall" Class="mt-12">
    <MudPaper Class="pa-6" Elevation="1">
        <MudText Typo="Typo.h6">管理员登录</MudText>
        @if (!string.IsNullOrWhiteSpace(_error))
        {
            <MudAlert Severity="Severity.Error" Class="mt-4">@_error</MudAlert>
        }

        <form method="post" action="/api/auth/login" class="mt-4">
            <MudTextField T="string" UserAttributes="@_usernameUserAttributes" Label="用户名" Variant="Variant.Outlined" Required="true" FullWidth="true" />
            <MudTextField T="string" UserAttributes="@_passwordUserAttributes" Label="密码" Variant="Variant.Outlined" InputType="InputType.Password" Required="true" FullWidth="true" Class="mt-3" />
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" Class="mt-4">登录</MudButton>
        </form>
    </MudPaper>
</MudContainer>

@code {
    [SupplyParameterFromQuery]
    public string? Error { get; set; }

    private string? _error;
    private readonly Dictionary<string, object> _usernameUserAttributes = new()
    {
        ["name"] = "username",
        ["autocomplete"] = "username",
    };

    private readonly Dictionary<string, object> _passwordUserAttributes = new()
    {
        ["name"] = "password",
        ["autocomplete"] = "current-password",
    };

    protected override void OnParametersSet()
    {
        _error = string.IsNullOrWhiteSpace(Error) ? null : Error;
    }
}
